<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Categories</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&display=swap" rel="stylesheet">
    <style>body { font-family: 'Rajdhani', sans-serif; }</style>
</head>
<body class="bg-gray-900 text-white min-h-screen p-4 pb-20">

    <!-- Header -->
    <div class="flex items-center justify-between mb-6 sticky top-0 bg-gray-900 z-50 py-2">
        <div class="flex items-center">
            <a href="/admin/dashboard" class="bg-gray-800 p-2 rounded-lg hover:bg-gray-700 mr-4 border border-gray-600 transition active:scale-95">
                <i class="fa-solid fa-arrow-left text-blue-400"></i>
            </a>
            <h1 class="text-2xl font-bold text-white tracking-wide">Categories</h1>
        </div>
        <button id="addCategoryBtn" class="bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-4 rounded-lg flex items-center gap-2 transition active:scale-95">
            <i class="fa-solid fa-plus"></i> New
        </button>
    </div>

    <!-- Category List -->
    <div id="categoriesList" class="space-y-4">
        <!-- Skeleton Loader -->
        <div class="animate-pulse bg-gray-800 rounded-lg h-12 border border-gray-700"></div>
        <div class="animate-pulse bg-gray-800 rounded-lg h-12 border border-gray-700"></div>
    </div>

    <script>
        // --- Authentication Check (Client Side) ---
        // Ensures user is logged in before loading dashboard data.
        function checkAdminAuth() {
            const adminToken = localStorage.getItem('adminToken');
            if (!adminToken) {
                window.location.href = '/index.html';
            }
        }

        async function loadCategories() {
            try {
                const categoriesList = document.getElementById('categoriesList');
                categoriesList.innerHTML = `
                    <div class="animate-pulse bg-gray-800 rounded-lg h-12 border border-gray-700"></div>
                    <div class="animate-pulse bg-gray-800 rounded-lg h-12 border border-gray-700"></div>
                `;

                const adminToken = localStorage.getItem('adminToken');
                if (!adminToken) throw new Error("Authentication token missing. Please log in again.");

                const res = await fetch('/api/admin', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${adminToken}` // Send token for authentication
                    },
                    body: JSON.stringify({ type: 'list_categories' }) // Request type parameter
                });

                if (!res.ok) {
                    const errorDetails = await res.json();
                    if (res.status === 401 || res.status === 403) {
                        localStorage.removeItem('adminToken');
                        window.location.href = '/index.html'; // Redirect on auth failure
                    }
                    throw new Error(errorDetails.error || `HTTP error! status: ${res.status}`);
                }

                const data = await res.json();

                if (!data.success) {
                    throw new Error(data.error || 'API call failed without specific error message.');
                }

                categoriesList.innerHTML = ''; // Clear skeleton loader

                if (data.categories && data.categories.length > 0) {
                    data.categories.forEach(category => {
                        categoriesList.innerHTML += `
                            <div class="p-4 bg-gray-800 rounded-lg shadow-md border border-gray-700 flex justify-between items-center transition active:scale-95">
                                <h3 class="font-bold text-lg text-white">${category.title}</h3>
                                <div>
                                    <button onclick="editCategory(${category.id})" class="text-blue-400 hover:text-blue-300 mr-2"><i class="fa-solid fa-pencil"></i></button>
                                    <button onclick="deleteCategory(${category.id})" class="text-red-400 hover:text-red-300"><i class="fa-solid fa-trash"></i></button>
                                </div>
                            </div>
                        `;
                    });
                } else {
                    categoriesList.innerHTML = `
                        <div class="text-center py-10 opacity-50">
                            <i class="fa-solid fa-folder-open text-4xl mb-3"></i>
                            <p>No categories found in database.</p>
                        </div>
                    `;
                }

            } catch (err) {
                console.error('Error loading categories:', err);
                const categoriesList = document.getElementById('categoriesList');
                categoriesList.innerHTML = `<p class="text-center text-red-500 py-10">Error loading data: ${err.message}</p>`;
            }
        }

        // --- Event Listeners and Initial Load ---
        document.addEventListener('DOMContentLoaded', () => {
            checkAdminAuth();
            loadCategories();
        });

        // --- Placeholder functions for Edit/Delete ---
        function editCategory(id) {
            alert('Edit Category ID: ' + id);
            // Implement redirect or modal logic here
        }

        function deleteCategory(id) {
            alert('Delete Category ID: ' + id);
            // Implement API call to delete category here
        }
    </script>
</body>
</html>

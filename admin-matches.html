<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Matches</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body class="bg-gray-900 text-white pb-20">

    <header class="p-4 bg-gray-800 shadow-md flex items-center sticky top-0 z-50">
        <a href="/admin-categories" class="mr-4 text-gray-400"><i class="fa-solid fa-arrow-left"></i></a>
        <div class="text-xl font-bold">Manage Matches</div>
    </header>

    <div class="p-4">
        <!-- Add Match Button -->
        <button onclick="window.location.href='/admin/add-tournament'" class="w-full bg-blue-600 py-3 rounded-lg font-bold mb-6 shadow-lg flex items-center justify-center gap-2">
            <i class="fa-solid fa-plus-circle"></i> Create New Match
        </button>

        <h3 class="font-bold mb-3 text-gray-400 border-b border-gray-700 pb-2">Active Matches</h3>
        <div id="match_list" class="space-y-4">
            <p class="text-center text-gray-500 mt-10 animate-pulse">Loading matches...</p>
        </div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const categoryId = urlParams.get('cat_id');

        if(!categoryId) {
            alert("No category selected!");
            window.location.href = '/admin-categories';
        }

        async function loadMatches() {
            try {
                // আমরা ইউজারের tournament_list API ব্যবহার করছি কারণ এটা অ্যাডমিনের জন্যও একই ডেটা দেয়
                const res = await fetch('/api/user', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ type: 'tournament_list', category_id: categoryId })
                });
                const data = await res.json();
                
                const list = document.getElementById('match_list');
                if (data.tournaments.length > 0) {
                    list.innerHTML = data.tournaments.map(t => `
                        <div class="bg-gray-800 rounded-xl overflow-hidden shadow-lg border border-gray-700 relative">
                            <img src="${t.image}" class="w-full h-32 object-cover opacity-80">
                            <div class="absolute top-2 right-2 flex gap-2">
                                <button onclick="deleteMatch(${t.id})" class="bg-red-600 w-8 h-8 rounded-full flex items-center justify-center shadow-lg"><i class="fa-solid fa-trash text-sm"></i></button>
                                <button onclick="alert('Edit feature coming soon')" class="bg-yellow-500 w-8 h-8 rounded-full flex items-center justify-center shadow-lg"><i class="fa-solid fa-pen text-sm text-black"></i></button>
                            </div>
                            <div class="p-4">
                                <h3 class="font-bold text-lg mb-1">${t.title}</h3>
                                <div class="flex justify-between text-sm text-gray-400">
                                    <span>${new Date(t.start_time).toLocaleDateString()}</span>
                                    <span class="text-green-400 font-bold">Prize: ৳${t.prize_pool}</span>
                                </div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    list.innerHTML = '<p class="text-center text-gray-500 mt-5">No matches found in this category.</p>';
                }
            } catch (e) { console.error(e); }
        }

        async function deleteMatch(id) {
            if(!confirm("Delete this match?")) return;
            
            const res = await fetch('/api/admin', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ type: 'delete_match', id })
            });
            const data = await res.json();
            if(data.success) {
                alert("Match Deleted!");
                loadMatches();
            } else {
                alert("Failed to delete");
            }
        }

        loadMatches();
    </script>
</body>
</html>
